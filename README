Builds as 64bit only so make sure you have propper firmware!

# sync omni source

Refer to http://source.android.com/source/downloading.html
Refer to https://github.com/omnirom/android

$ repo init -u git://github.com/omnirom/android.git -b android-10

copy https://github.com/maxwen/android_device_brcm_rpi4/blob/android-10/repo/local_manifest.xml .repo/local_manifests/

If you are not building based on omni to use roomservice check local_manifest_full.xml

If you want to use the contents of omni-private.xml please check
https://github.com/omnirom/android/README and head over to send us a short
email notice. Otherwise you can simple remove the include of that xml
file and build without

This uses some repos from https://github.com/lineage-rpi
please check omni.dependencies for the complete list

$ repo sync

# Build Android source

Refer to http://source.android.com/source/building.html

# prepare environment

$ export ROM_BUILDTYPE=MICROG
$ export TEMPORARY_DISABLE_PATH_RESTRICTIONS=true
$ export ALLOW_MISSING_DEPENDENCIES=true
$ export PRODUCT_EXCLUDE_EXTRA_PACKAGES=true
$ source build/envsetup.sh
$ lunch omni_rpi4-userdebug

# add any not yet merged changes and fixes specific for rpi4

Refer to https://gerrit.omnirom.org/q/topic:raspi_bits

# build

make bootimage systemimage vendorimage

Use -j[n] option with make, if build host has a good number of CPU cores.

# prepare sd card

Check and adjust to your needs (default layout for 8gb)
$ANDROID_BUILD_TOP/device/brcm/rpi4/scripts/mk-raspi64-large-image.sh

Flash image to your sd-card

Configurations

Change audio output from hdmi to headphone jack
system.prop change audio.pcm.card=0 -> audio.pcm.card=1

Change config.txt
vendor/brcm/rpi4/proprietary/boot/config.txt

USB boot
Change fstab.rpi4 to

/dev/block/sda2    /system             ext4      ro,barrier=1                                          wait,first_stage_mount
/dev/block/sda3    /vendor             ext4      ro,barrier=1                                          wait,first_stage_mount
/dev/block/sda4    /data               ext4      noatime,nosuid,nodev,barrier=1,noauto_da_alloc,discard latemount,wait,check,fileencryption=aes-256-xts